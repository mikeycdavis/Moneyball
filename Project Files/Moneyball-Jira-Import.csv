Issue Type,Issue ID,Parent,Summary,Description,Priority,Story Points,Labels
Epic,1,,"Foundation & Architecture","Set up the solution structure: .NET 8 solution with four projects (API / Core / Infrastructure / Tests), project-to-project references, all NuGet packages, DI wiring in Program.cs, Swagger, appsettings.json, and .gitignore.",High,,foundation
Story,2,1,"Create .NET 8 solution with four projects","As a developer, I need the solution scaffolded with SportsBetting.API, SportsBetting.Core, SportsBetting.Infrastructure, and SportsBetting.Tests so that all code has a clear home and project references are correct. Acceptance Criteria: dotnet build succeeds with zero errors; all four .csproj files referenced in the .sln; project-to-project references wired correctly.",Critical,2,foundation
Story,3,1,"Configure NuGet packages across all projects","As a developer, I need all required NuGet packages restored so that builds are repeatable. Acceptance Criteria: EF Core 8, Polly, Swashbuckle, xUnit, Moq, and FluentAssertions all present in correct projects; dotnet restore succeeds on a clean machine.",Critical,1,foundation
Story,4,1,"Set up DI container in Program.cs","As a developer, I need all services registered in the DI container so the app starts cleanly. Acceptance Criteria: All services resolve at startup; no missing-registration exceptions; app starts and responds on the expected port.",Critical,2,foundation
Story,5,1,"Add Swagger/OpenAPI documentation","As an API consumer, I need a Swagger UI so I can explore and test endpoints without a separate tool. Acceptance Criteria: Swagger UI loads at /swagger; all current endpoints visible with correct HTTP verbs and route parameters.",Medium,1,foundation
Story,6,1,"Create appsettings.json with all configuration sections","As a developer, I need a complete appsettings.json so all settings are discoverable and documented. Acceptance Criteria: ConnectionStrings, SportsData (ApiKey + BaseUrl), OddsAPI (ApiKey + BaseUrl), DataIngestion (EnableBackgroundService + UpdateIntervalHours) all present.",High,1,foundation
Story,7,1,"Add .gitignore excluding secrets and build artefacts","As a developer, I need a .gitignore so API keys and build output are never committed. Acceptance Criteria: appsettings.*.json, bin/, obj/, .vs/ all excluded; appsettings.json itself is tracked.",Low,1,foundation
Epic,8,,"Database & Data Access Layer","Define all EF Core entities, configure the DbContext with indexes and seed data, create the full repository pattern with Unit of Work, and produce an idempotent T-SQL setup script.",Critical,,database
Story,9,8,"Define all Core entities","As a developer, I need all nine domain entities defined so EF Core can generate the schema. Acceptance Criteria: Sport, Team, Game, GameOdds, TeamStatistic, Model, ModelPerformance, Prediction, and BettingRecommendation all exist with correct FK relationships and data annotations.",Critical,3,database
Story,10,8,"Create SportsBettingDbContext with full configuration","As a developer, I need DbContext OnModelCreating to configure indexes, unique constraints, FK delete behaviour, and seed data. Acceptance Criteria: All entities mapped; unique constraints on Sport.Name and Model(Name+Version); seed data inserts NBA/NFL/NHL/MLB sports; migrations generate cleanly.",Critical,3,database
Story,11,8,"Add EF Core indexes for query-critical columns","As a developer, I need targeted indexes so common queries run fast. Acceptance Criteria: Indexes exist on GameDate, SportId+GameDate, ExternalGameId, Status+GameDate, ModelId+CreatedAt, and Edge+CreatedAt.",High,2,database
Story,12,8,"Implement generic Repository<T> base class","As a developer, I need a reusable base repository so specialised repos share CRUD logic. Acceptance Criteria: GetByIdAsync, FindAsync, AddAsync, AddRangeAsync, UpdateAsync, DeleteAsync, CountAsync, ExistsAsync all implemented and passing unit tests.",Critical,2,database
Story,13,8,"Implement GameRepository with specialised queries","As a developer, I need game-specific queries so the rest of the system can fetch data without writing raw LINQ. Acceptance Criteria: GetUpcomingGamesAsync filters to future Scheduled games; GetGameByExternalIdAsync returns correct row; GetGameWithDetailsAsync eager-loads HomeTeam, AwayTeam, Odds, Predictions.",High,2,database
Story,14,8,"Implement TeamRepository","As a developer, I need team-specific queries so ingestion services can look up teams by external ID. Acceptance Criteria: GetByExternalIdAsync returns correct team; GetBySportAsync returns all teams for a sport ordered by name.",High,1,database
Story,15,8,"Implement GameOddsRepository","As a developer, I need odds-specific queries to fetch the latest odds snapshot per game. Acceptance Criteria: GetLatestOddsAsync returns newest row by RecordedAt; GetOddsHistoryAsync returns all rows desc; GetLatestOddsForGamesAsync batches correctly.",High,2,database
Story,16,8,"Implement PredictionRepository","As a developer, I need prediction queries for the recommendation engine. Acceptance Criteria: GetPredictionsByGameAsync returns all model predictions for a game; GetPredictionsWithHighEdgeAsync filters by minEdge and only upcoming games.",High,2,database
Story,17,8,"Implement ModelRepository","As a developer, I need model-specific queries to load active models at runtime. Acceptance Criteria: GetActiveModelsAsync returns only IsActive=true for the given sport; GetByNameAndVersionAsync enforces uniqueness.",High,1,database
Story,18,8,"Implement Unit of Work with transaction support","As a developer, I need Unit of Work so all writes in a single ingestion step are atomic. Acceptance Criteria: BeginTransactionAsync/CommitTransactionAsync/RollbackTransactionAsync all work; all repositories accessible via IUnitOfWork; dispose releases resources.",Critical,2,database
Story,19,8,"Create idempotent DatabaseSetup.sql script","As a DBA/developer, I need a script I can run repeatedly to initialise the database. Acceptance Criteria: Script runs twice without errors; all tables, indexes, and seed sports created; existing data not duplicated.",High,2,database
Story,20,8,"Add EF Core migration for initial schema","As a developer, I need an EF migration so the database can be created from code. Acceptance Criteria: dotnet ef database update succeeds; all tables present; seed data visible in Sports table.",Medium,1,database
Epic,21,,"Data Ingestion Pipeline","Build the full data ingestion stack: SportRadar and Odds API HTTP clients with Polly resilience, ingestion services for NBA teams/schedule/stats/odds, an orchestrator, a background service, and manual REST trigger endpoints.",Critical,,ingestion
Story,22,21,"Create ISportsDataService and SportsDataService (SportRadar)","As a developer, I need a typed HTTP client for SportRadar so NBA data can be fetched reliably. Acceptance Criteria: GetNBATeamsAsync parses hierarchy response; GetNBAScheduleAsync iterates per-day endpoints with 1-second delay; GetNBAGameStatisticsAsync returns box-score data.",Critical,3,ingestion
Story,23,21,"Create IOddsDataService and OddsDataService (The Odds API)","As a developer, I need a typed HTTP client for The Odds API so moneyline, spread, and total odds are fetched. Acceptance Criteria: GetOddsAsync fetches h2h+spreads+totals markets; x-requests-remaining header is logged; empty response returned gracefully on non-200.",Critical,2,ingestion
Story,24,21,"Add Polly retry and circuit-breaker policies to HTTP clients","As an operator, I need resilience on all external HTTP calls so transient failures don't break the pipeline. Acceptance Criteria: 3 retries with exponential back-off on 5xx and 429; circuit breaker opens after 5 consecutive failures; policies applied to both HTTP clients via DI.",High,2,ingestion
Story,25,21,"Implement IngestNBATeamsAsync","As a developer, I need NBA teams upserted on every run. Acceptance Criteria: 30 teams created on first run; re-run updates Name/Abbreviation/City if changed; no duplicate rows; count logged.",Critical,2,ingestion
Story,26,21,"Implement IngestNBAScheduleAsync with upsert logic","As a developer, I need the NBA schedule synced daily. Acceptance Criteria: New games inserted by ExternalGameId; existing games updated for Status and scores; IsComplete flipped when status is closed; games added and updated counts logged.",Critical,3,ingestion
Story,27,21,"Implement IngestNBAGameStatisticsAsync","As a developer, I need box-score stats stored per game. Acceptance Criteria: All NBAStatistics fields mapped to TeamStatistic columns; upsert replaces stale rows; both home and away stats stored per game.",High,2,ingestion
Story,28,21,"Implement IngestOddsAsync with team-name matching","As a developer, I need odds inserted per bookmaker per game. Acceptance Criteria: Odds matched to Game by date window and team name substring; moneyline, spread, and total fields populated; one GameOdds row per bookmaker per ingestion run; unmatched games logged as debug.",Critical,3,ingestion
Story,29,21,"Implement UpdateGameResultsAsync for completed games","As a developer, I need final scores synced after games end. Acceptance Criteria: Games within last 48 hours checked; IsComplete flipped; HomeScore/AwayScore populated; count logged.",High,2,ingestion
Story,30,21,"Build DataIngestionOrchestrator","As a developer, I need an orchestrator that sequences teams then schedule then odds. Acceptance Criteria: RunFullIngestionAsync calls IngestNBATeamsAsync then IngestNBAScheduleAsync then IngestOddsAsync in order; RunScheduledUpdatesAsync runs schedule+odds+results concurrently per sport.",High,2,ingestion
Story,31,21,"Implement DataIngestionBackgroundService (IHostedService)","As an operator, I need data refreshed automatically every hour. Acceptance Criteria: Service starts on app boot with 1-minute startup delay; RunScheduledUpdatesAsync called every configured interval; exceptions caught and logged without crashing the host; configurable via DataIngestion:EnableBackgroundService.",High,2,ingestion
Story,32,21,"Create DataIngestionController with manual trigger endpoints","As a developer, I need REST endpoints to trigger ingestion manually during development and debugging. Acceptance Criteria: POST /api/dataingestion/full/{sportId}, /nba/teams, /nba/schedule, /odds/{sport}, /update, /results/{sportId} all return 200 on success; 500 with error body on failure.",Medium,2,ingestion
Story,33,21,"Create GamesController (upcoming, detail, date-range, odds)","As an API consumer, I need to query game data via REST. Acceptance Criteria: GET /upcoming returns future Scheduled games; GET /{gameId} returns teams+odds+stats+predictions; GET /range filters by date; GET /odds/latest returns newest odds snapshot; 404 for missing gameId.",Medium,2,ingestion
Epic,34,,"ML Model Management","Build model registry CRUD, Python Flask prediction service, ML.NET executor, A/B testing support across multiple active models, and automated performance recording after game results.",High,,ml-models
Story,35,34,"Define IModelExecutor interface","As a developer, I need a common executor contract so Python and ML.NET models are interchangeable. Acceptance Criteria: IModelExecutor has ExecuteAsync(Model model, Dictionary<string,object> features) returning PredictionResult with HomeWinProbability, AwayWinProbability, and Confidence.",Critical,1,ml-models
Story,36,34,"Implement PythonModelExecutor (HTTP to Flask service)","As a developer, I need the .NET API to call Python models via HTTP. Acceptance Criteria: POSTs feature dict to configured Flask URL; deserialises PredictionResult; throws meaningful exception on non-200; model_name formed as Name_Version.",Critical,3,ml-models
Story,37,34,"Implement MLNetModelExecutor","As a developer, I need an optional C# model executor using ML.NET. Acceptance Criteria: Loads .zip model from FilePath; runs prediction; returns same PredictionResult shape as Python executor.",Medium,3,ml-models
Story,38,34,"Build Python Flask prediction_service.py","As a data scientist, I need a local Flask service that loads versioned models and returns predictions. Acceptance Criteria: All IsActive Python models loaded at startup; POST /predict returns probabilities in < 200ms; model not found returns 404 JSON; prepare_features maps feature dict to numpy array.",High,3,ml-models
Story,39,34,"Implement model registry CRUD in ModelsController","As a developer, I need REST endpoints to register and manage models. Acceptance Criteria: POST /api/models registers a new model; GET /api/models lists all; GET /api/models/{id} returns detail with Metadata; PUT /api/models/{id}/activate and /deactivate toggle IsActive.",High,2,ml-models
Story,40,34,"Support multiple active models per sport (A/B testing)","As a developer, I need the system to run all active models for a sport simultaneously. Acceptance Criteria: GetActiveModelsAsync returns all IsActive=true for a SportId; GeneratePredictionsForAllActiveModelsAsync creates one Prediction row per model; no model blocks another.",High,2,ml-models
Story,41,34,"Store Metadata JSON on model registration","As a developer, I need hyperparameters and feature lists persisted with the model. Acceptance Criteria: Metadata round-trips as valid JSON; displayed in GET /api/models/{id}; no schema change required to add new metadata fields.",Medium,1,ml-models
Story,42,34,"Implement ModelPerformance recording after game results","As a developer, I need model accuracy and ROI tracked automatically. Acceptance Criteria: After IsComplete flipped, Accuracy and ROI computed per model; ModelPerformance row inserted; Metrics JSON contains precision, recall, and sample size.",Medium,2,ml-models
Epic,43,,"Predictions & Edge Calculation","Build the feature engineering pipeline, prediction generation per model, edge calculation against implied odds, and confidence scoring stored on the Prediction entity.",High,,predictions
Story,44,43,"Design feature engineering pipeline interface","As a developer, I need a contract for building ML feature vectors from game data. Acceptance Criteria: IFeatureService with BuildFeaturesAsync(Game game) returning Dictionary<string,object>; registered in DI; mock implementable for tests.",High,2,predictions
Story,45,43,"Implement NBA feature set","As a data scientist, I need NBA-specific features so models have signal. Acceptance Criteria: Home ELO, away ELO, home rest days, away rest days, home win streak, away win streak, and home/away split records all computed from historical game data and included in the feature dict.",High,5,predictions
Story,46,43,"Implement GeneratePredictionAsync per model","As a developer, I need predictions generated and persisted per model per game. Acceptance Criteria: Builds features; calls correct IModelExecutor; inserts Prediction row with ModelId, GameId, PredictedHomeWinProbability, PredictedAwayWinProbability, Confidence, and FeatureValues JSON.",Critical,2,predictions
Story,47,43,"Implement GeneratePredictionsForAllActiveModels","As a developer, I need all active models run for a game in one call. Acceptance Criteria: Fetches all active models for the game's sport; calls GeneratePredictionAsync for each; all predictions saved in a single SaveChangesAsync.",High,2,predictions
Story,48,43,"Calculate edge: model probability minus implied market probability","As a developer, I need edge stored on each Prediction so it can be filtered later. Acceptance Criteria: Edge = PredictedWinProbability - ImpliedProbability; stored on Prediction.Edge; negative edge stored as-is (not clamped).",Critical,2,predictions
Story,49,43,"Implement American-odds-to-implied-probability conversion","As a developer, I need odds converted accurately so edge is meaningful. Acceptance Criteria: Positive odds formula: 100/(odds+100); negative odds formula: |odds|/(|odds|+100); unit tested with +150, -110, +100, -200 cases.",Critical,1,predictions
Story,50,43,"Store FeatureValues JSON snapshot on each Prediction","As a developer, I need the feature vector persisted for auditability. Acceptance Criteria: Feature dict serialised to JSON and stored in Prediction.FeatureValues; can be deserialised back to original dict.",Medium,1,predictions
Epic,51,,"Betting Recommendations API","Build the Kelly Criterion calculator, BettingRecommendationService, the POST /api/bettingrecommendations endpoint with bankroll input and stake-sized output, and model ensemble support.",Critical,,recommendations
Story,52,51,"Implement KellyCriterionCalculator with fractional Kelly","As a developer, I need the Kelly formula implemented correctly. Acceptance Criteria: f=(b*p-q)/b * fractionOfKelly; negative result clamped to 0; fractionOfKelly defaults to 0.25; unit tested with at least five prob/odds/fraction combinations.",Critical,2,recommendations
Story,53,51,"Create BettingRecommendationRequest and Response DTOs","As a developer, I need typed request/response models for the endpoint. Acceptance Criteria: Request has Bankroll (required, > 0), TopN (default 5), MinEdge (default 0.05), MinConfidence (default 0.60), optional SportId and ModelIds; Response has Recommendations list, TotalStake, and RemainingBankroll.",High,1,recommendations
Story,54,51,"Implement BettingRecommendationService.GetRecommendationsAsync","As a developer, I need the core recommendation logic. Acceptance Criteria: Fetches upcoming games; gets latest predictions filtered by ModelIds if provided; filters by MinEdge and MinConfidence; orders by Edge descending; takes TopN; empty list returned gracefully when no games qualify.",Critical,4,recommendations
Story,55,51,"Calculate RecommendedStake from bankroll and Kelly fraction","As a developer, I need the dollar stake computed per recommendation. Acceptance Criteria: RecommendedStake = Bankroll * KellyFraction; StakePercentage = KellyFraction; TotalStake = sum of all stakes; RemainingBankroll = Bankroll - TotalStake.",Critical,2,recommendations
Story,56,51,"Expose POST /api/bettingrecommendations endpoint","As an API consumer, I need a single endpoint to get top-N value bets with stake sizes. Acceptance Criteria: Returns array of GameRecommendation with HomeTeam, AwayTeam, GameDate, RecommendedBet side, Edge, Confidence, PredictedWinProbability, ImpliedOddsProbability, RecommendedStake, StakePercentage, ModelName, ModelVersion; 400 if Bankroll <= 0.",Critical,2,recommendations
Story,57,51,"Include recommended bet side (home or away) in each recommendation","As a bettor, I need to know which side to bet. Acceptance Criteria: RecommendedBet field shows 'Home Moneyline' or 'Away Moneyline'; determined by whichever side has positive edge; correct moneyline odds included.",High,1,recommendations
Story,58,51,"Support model ensemble averaging across multiple models","As a developer, I need multiple models combined into a single probability estimate. Acceptance Criteria: When ModelIds array provided, probabilities averaged equally across specified models; averaged edge used for ranking and Kelly sizing.",Medium,3,recommendations
Story,59,51,"Validate MinEdge and MinConfidence in controller","As a developer, I need input validation so nonsensical thresholds are rejected early. Acceptance Criteria: 400 returned if MinEdge outside [0, 1]; 400 returned if MinConfidence outside [0, 1]; validation message in response body.",Medium,1,recommendations
Epic,60,,"Testing","Comprehensive unit tests for all service logic and repository queries using in-memory DB, integration tests for full pipeline and controllers, and Kelly/odds-conversion edge-case coverage.",High,,testing
Story,61,60,"GameRepository unit tests (in-memory DB)","As a developer, I need repository tests so query logic is verified independently of SQL Server. Acceptance Criteria: GetUpcomingGamesAsync returns only future Scheduled games; GetByExternalIdAsync returns correct game; GetGameWithDetailsAsync eager-loads all navigation properties.",High,2,testing
Story,62,60,"GameOddsRepository unit tests","As a developer, I need odds repository tests. Acceptance Criteria: GetLatestOddsAsync returns newest row by RecordedAt; bookmaker filter returns correct subset; GetOddsHistoryAsync ordered descending.",High,1,testing
Story,63,60,"PredictionRepository unit tests","As a developer, I need prediction repository tests. Acceptance Criteria: GetPredictionsWithHighEdgeAsync filters by minEdge; only upcoming game predictions returned; correct model included in result.",High,2,testing
Story,64,60,"KellyCriterionCalculator unit tests","As a developer, I need Kelly formula tests with known inputs and outputs. Acceptance Criteria: Theory-driven with at least five prob/odds/fraction inputs; negative Kelly clamped to 0; full Kelly (fraction=1.0) produces correct result.",Critical,1,testing
Story,65,60,"American odds to implied probability unit tests","As a developer, I need conversion tests for all odds formats. Acceptance Criteria: +150 → 0.4; -110 → 0.5238; -200 → 0.6667; +100 → 0.5; all within 0.0001 tolerance.",High,1,testing
Story,66,60,"DataIngestionService unit tests with mocked HTTP clients","As a developer, I need ingestion service tests without real API calls. Acceptance Criteria: IngestNBATeamsAsync upsert logic tested with mock returning 2 teams; IngestOddsAsync maps odds to correct GameId; rate-limit delay verified not to block tests.",High,3,testing
Story,67,60,"BettingRecommendationService unit tests","As a developer, I need recommendation service tests covering all filter and sizing logic. Acceptance Criteria: MinEdge filter removes low-edge predictions; TopN limit enforced; RecommendedStake = Bankroll * KellyFraction; empty list returned when no predictions pass thresholds.",Critical,3,testing
Story,68,60,"End-to-end integration test: ingestion through recommendation","As a developer, I need a pipeline integration test so I know all layers connect. Acceptance Criteria: Seeds DB with sport, teams, game, odds; runs ingestion mocks; generates prediction; calls recommendation endpoint; verifies at least one recommendation returned with correct stake.",Medium,3,testing
Story,69,60,"DataIngestionController integration tests","As a developer, I need controller integration tests using TestServer. Acceptance Criteria: POST /api/dataingestion/nba/teams returns 200 with mock service; invalid sport key returns 500 with error body; scheduled update endpoint returns 200.",Medium,2,testing
Story,70,60,"BettingRecommendationsController integration tests","As a developer, I need recommendation controller tests. Acceptance Criteria: Valid request body returns 200 with recommendation array; bankroll=0 returns 400; bankroll omitted returns 400.",High,2,testing
Epic,71,,"NFL Extension","Extend data ingestion, statistics mapping, odds ingestion, and feature engineering to cover the NFL using the sport-agnostic architecture. Targeted for v1.1.",Low,,nfl
Story,72,71,"Add NFL team ingestion","As a developer, I need NFL teams loaded using the existing sport-agnostic Team entity. Acceptance Criteria: NFL teams stored with SportId=2; no schema changes required; ExternalId maps to SportRadar NFL team GUID.",Medium,2,nfl
Story,73,71,"Implement NFL schedule ingestion","As a developer, I need NFL games stored with week numbers. Acceptance Criteria: NFL games ingested under SportId=2; Week column populated; upsert logic matches NBA implementation pattern.",Medium,3,nfl
Story,74,71,"Map NFL-specific statistics to TeamStatistic columns","As a developer, I need football stats stored in the shared schema. Acceptance Criteria: PassingYards, RushingYards, TotalYards, Touchdowns, Interceptions, Fumbles, Sacks, and TimeOfPossession all populated from NFL box-score API response.",Medium,2,nfl
Story,75,71,"Wire americanfootball_nfl odds ingestion","As a developer, I need NFL odds fetched the same way as NBA odds. Acceptance Criteria: POST /api/dataingestion/odds/americanfootball_nfl returns 200; odds matched to NFL games by date and team name.",Medium,2,nfl
Story,76,71,"Create NFL feature engineering pipeline","As a data scientist, I need NFL-specific ML features. Acceptance Criteria: Features include yard differential, turnover margin, third-down conversion rate, red zone efficiency, and days rest; returned from NFL implementation of IFeatureService.",Low,5,nfl
Story,77,71,"Register and test NFL-specific ML model","As a developer, I need an NFL model in the registry. Acceptance Criteria: Model registered under SportId=2; GeneratePredictionsForAllActiveModels runs for NFL game; Prediction row created with correct sport context.",Low,3,nfl
